<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Blog Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f0f14;
  color:white;
}
header {
  background:#16161f;
  padding:15px;
  text-align:center;
  font-size:22px;
}
.container {
  max-width:900px;
  margin:auto;
  padding:15px;
}
input, textarea, button {
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  border:none;
}
input, textarea {
  background:#1e1e2e;
  color:white;
}
button {
  background:#5b5bff;
  color:white;
  cursor:pointer;
}
button:hover { background:#7777ff; }
.post {
  background:#1a1a28;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}
.comment {
  background:#222;
  padding:6px;
  border-radius:6px;
  margin-top:5px;
  font-size:14px;
}
.admin {
  background:crimson;
}
.hidden {
  display:none;
}
</style>
</head>
<body>

<header>üìù Blog Platform</header>

<div class="container">

<!-- AUTH -->
<div id="auth">
  <h3>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
  <button onclick="login()">–í–æ–π—Ç–∏</button>
  <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <p>üë§ <span id="userEmail"></span></p>
  <button onclick="logout()">–í—ã–π—Ç–∏</button>

  <div id="adminPanel" class="hidden">
    <h3>üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
    <p>–í—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</p>
  </div>

  <hr>

  <h3>–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é</h3>
  <input id="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
  <textarea id="content" rows="5" placeholder="–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏"></textarea>
  <button onclick="addPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>

  <hr>

  <h3>üåç –ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</h3>
  <div id="posts"></div>
</div>

</div>

<script>
/* üî• FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyD26cvWaB4qeX5lAACiIEUMwoIGxSZv4SA",
  authDomain: "artem-c3ba1.firebaseapp.com",
  projectId: "artem-c3ba1",
  storageBucket: "artem-c3ba1.firebasestorage.app",
  messagingSenderId: "270844774844",
  appId: "1:270844774844:web:fb449e4853d8a4202dc3b9"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

const ADMIN_EMAIL = "admin@admin.com";

/* AUTH STATE */
auth.onAuthStateChanged(user => {
  if (user) {
    authDiv.style.display = "none";
    app.classList.remove("hidden");
    userEmail.textContent = user.email;
    if (user.email === ADMIN_EMAIL) {
      adminPanel.classList.remove("hidden");
    }
    loadPosts();
  }
});

/* AUTH FUNCTIONS */
function register() {
  auth.createUserWithEmailAndPassword(email.value, password.value)
    .catch(e => alert(e.message));
}

function login() {
  auth.signInWithEmailAndPassword(email.value, password.value)
    .catch(e => alert(e.message));
}

function logout() {
  auth.signOut();
  location.reload();
}

/* POSTS */
function addPost() {
  if (!title.value || !content.value) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å—ë");
  db.collection("posts").add({
    title: title.value,
    content: content.value,
    author: auth.currentUser.email,
    date: firebase.firestore.FieldValue.serverTimestamp()
  });
  title.value = "";
  content.value = "";
}

function loadPosts() {
  db.collection("posts").orderBy("date","desc")
    .onSnapshot(snap => {
      posts.innerHTML = "";
      snap.forEach(doc => {
        const p = doc.data();
        posts.innerHTML += `
        <div class="post">
          <h2>${p.title}</h2>
          <small>${p.author}</small>
          <p>${p.content}</p>

          <input placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" id="c-${doc.id}">
          <button onclick="addComment('${doc.id}')">üí¨ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>

          ${auth.currentUser.email === ADMIN_EMAIL
            ? `<button class="admin" onclick="deletePost('${doc.id}')">üóë –£–¥–∞–ª–∏—Ç—å</button>`
            : ""}

          <div id="comments-${doc.id}"></div>
        </div>`;
        loadComments(doc.id);
      });
    });
}

function deletePost(id) {
  if (!confirm("–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—å—é?")) return;
  db.collection("posts").doc(id).delete();
}

/* COMMENTS */
function addComment(postId) {
  const input = document.getElementById("c-"+postId);
  if (!input.value) return;
  db.collection("comments").add({
    post: postId,
    text: input.value,
    author: auth.currentUser.email
  });
  input.value = "";
}

function loadComments(postId) {
  db.collection("comments").where("post","==",postId)
    .onSnapshot(snap => {
      const el = document.getElementById("comments-"+postId);
      el.innerHTML = "";
      snap.forEach(c => {
        el.innerHTML += `
        <div class="comment">
          <b>${c.data().author}:</b> ${c.data().text}
          ${auth.currentUser.email === ADMIN_EMAIL
            ? `<button onclick="deleteComment('${c.id}')">üóë</button>`
            : ""}
        </div>`;
      });
    });
}

function deleteComment(id) {
  db.collection("comments").doc(id).delete();
}
</script>

</body>
</html>
